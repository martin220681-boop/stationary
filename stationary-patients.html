<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stationary Patients</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as inline SVG components
        const ChevronDown = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronRight = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const X = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Archive = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="21 8 21 21 3 21 3 8"></polyline>
                <rect x="1" y="3" width="22" height="5"></rect>
                <line x1="10" y1="12" x2="14" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        // Simple localStorage wrapper to mimic window.storage API
        const storage = {
            get: async (key) => {
                try {
                    const value = localStorage.getItem(key);
                    if (value === null) throw new Error('Key not found');
                    return { key, value, shared: false };
                } catch (error) {
                    throw error;
                }
            },
            set: async (key, value) => {
                try {
                    localStorage.setItem(key, value);
                    return { key, value, shared: false };
                } catch (error) {
                    console.error('Storage error:', error);
                    return null;
                }
            },
            delete: async (key) => {
                try {
                    localStorage.removeItem(key);
                    return { key, deleted: true, shared: false };
                } catch (error) {
                    console.error('Storage error:', error);
                    return null;
                }
            }
        };

        const StationaryPatients = () => {
            const [patients, setPatients] = useState([]);
            const [archivedPatients, setArchivedPatients] = useState([]);
            const [showAddPatient, setShowAddPatient] = useState(false);
            const [selectedPatient, setSelectedPatient] = useState(null);
            const [sortBy, setSortBy] = useState('name');
            const [filterStatus, setFilterStatus] = useState('all');
            const [showArchived, setShowArchived] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                setLoading(true);
                try {
                    const patientsResult = await storage.get('patients');
                    const archivedResult = await storage.get('archived-patients');
                    
                    if (patientsResult) {
                        setPatients(JSON.parse(patientsResult.value));
                    }
                    if (archivedResult) {
                        setArchivedPatients(JSON.parse(archivedResult.value));
                    }
                } catch (error) {
                    console.log('No existing data found, starting fresh');
                }
                setLoading(false);
            };

            const savePatients = async (updatedPatients) => {
                try {
                    await storage.set('patients', JSON.stringify(updatedPatients));
                    setPatients(updatedPatients);
                } catch (error) {
                    console.error('Error saving patients:', error);
                }
            };

            const saveArchivedPatients = async (updatedArchived) => {
                try {
                    await storage.set('archived-patients', JSON.stringify(updatedArchived));
                    setArchivedPatients(updatedArchived);
                } catch (error) {
                    console.error('Error saving archived patients:', error);
                }
            };

            const addPatient = async (name, dob) => {
                const newPatient = {
                    id: Date.now().toString(),
                    name,
                    dob,
                    createdAt: new Date().toISOString(),
                    specialty: null,
                    status: null,
                    verschoben: null,
                    dateOfAdmission: null,
                    icuAdmissions: [],
                    plannedOperation: '',
                    reasonForAdmission: '',
                    inSitu: {},
                    heimmedikation: '',
                    drg: null,
                    opVorbereitung: {},
                    geplantUntersuchungen: {},
                    zuweiser: {},
                    brief: { status: null, items: {} },
                    uebernahme: { status: null, items: {} },
                    entlassung: { datum: null, untersuchungen: [] },
                    wiederaufnahme: null,
                    medications: [],
                    complaints: null,
                    complications: {},
                    nebendiagnose: {},
                    privat: null,
                    remarks: {}
                };
                
                const updated = [...patients, newPatient];
                await savePatients(updated);
                return newPatient;
            };

            const deletePatient = async (id) => {
                const updated = patients.filter(p => p.id !== id);
                await savePatients(updated);
                if (selectedPatient?.id === id) {
                    setSelectedPatient(null);
                }
            };

            const archivePatient = async (id) => {
                const patient = patients.find(p => p.id === id);
                if (patient) {
                    const updated = patients.filter(p => p.id !== id);
                    await savePatients(updated);
                    const archivedUpdated = [...archivedPatients, { ...patient, archivedAt: new Date().toISOString() }];
                    await saveArchivedPatients(archivedUpdated);
                    if (selectedPatient?.id === id) {
                        setSelectedPatient(null);
                    }
                }
            };

            const updatePatient = async (id, updates) => {
                const updated = patients.map(p => p.id === id ? { ...p, ...updates } : p);
                await savePatients(updated);
                if (selectedPatient?.id === id) {
                    setSelectedPatient({ ...selectedPatient, ...updates });
                }
            };

            const calculateDaysOfAdmission = (dateOfAdmission) => {
                if (!dateOfAdmission) return 0;
                const admissionDate = new Date(dateOfAdmission);
                const today = new Date();
                const diffTime = today - admissionDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays + 1;
            };

            const getSortedPatients = () => {
                let filtered = showArchived ? archivedPatients : patients;
                
                if (filterStatus !== 'all') {
                    filtered = filtered.filter(p => {
                        if (filterStatus === 'preoperative') return p.status === 'preoperative';
                        if (filterStatus === 'postoperative') return p.status === 'postoperative';
                        if (filterStatus === 'discharged') return p.entlassung?.datum;
                        return true;
                    });
                }

                return filtered.sort((a, b) => {
                    if (sortBy === 'name') return a.name.localeCompare(b.name);
                    if (sortBy === 'dob') return new Date(a.dob) - new Date(b.dob);
                    if (sortBy === 'status') return (a.status || '').localeCompare(b.status || '');
                    return 0;
                });
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-slate-50 flex items-center justify-center">
                        <div className="text-slate-600 text-lg">Loading patients...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 font-sans">
                    <div className="max-w-7xl mx-auto p-4 md:p-6">
                        <div className="bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <h1 className="text-3xl font-bold text-slate-900">Stationary Patients</h1>
                                <button
                                    onClick={() => setShowAddPatient(true)}
                                    className="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    <Plus size={20} />
                                    Add Patient
                                </button>
                            </div>

                            <div className="flex flex-wrap gap-3">
                                <select
                                    value={sortBy}
                                    onChange={(e) => setSortBy(e.target.value)}
                                    className="px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="name">Sort by Name</option>
                                    <option value="dob">Sort by DOB</option>
                                    <option value="status">Sort by Status</option>
                                </select>

                                <select
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="all">All Patients</option>
                                    <option value="preoperative">Preoperative</option>
                                    <option value="postoperative">Postoperative</option>
                                    <option value="discharged">Discharged</option>
                                </select>

                                <button
                                    onClick={() => setShowArchived(!showArchived)}
                                    className={`px-4 py-2 border rounded-lg transition-colors ${
                                        showArchived 
                                            ? 'bg-slate-700 text-white border-slate-700' 
                                            : 'border-slate-300 text-slate-700 hover:bg-slate-50'
                                    }`}
                                >
                                    {showArchived ? 'Show Active' : 'Show Archived'}
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-lg shadow-sm border border-slate-200 p-4">
                                    <h2 className="text-lg font-semibold text-slate-900 mb-4">
                                        {showArchived ? 'Archived Patients' : 'Active Patients'} ({getSortedPatients().length})
                                    </h2>
                                    <div className="space-y-2 max-h-[calc(100vh-300px)] overflow-y-auto">
                                        {getSortedPatients().map(patient => (
                                            <PatientCard
                                                key={patient.id}
                                                patient={patient}
                                                isSelected={selectedPatient?.id === patient.id}
                                                onClick={() => setSelectedPatient(patient)}
                                                onDelete={deletePatient}
                                                onArchive={archivePatient}
                                                showArchived={showArchived}
                                            />
                                        ))}
                                        {getSortedPatients().length === 0 && (
                                            <div className="text-center py-8 text-slate-500">
                                                No patients found
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>

                            <div className="lg:col-span-2">
                                {selectedPatient ? (
                                    <PatientDetails
                                        patient={selectedPatient}
                                        onUpdate={updatePatient}
                                        calculateDays={calculateDaysOfAdmission}
                                    />
                                ) : (
                                    <div className="bg-white rounded-lg shadow-sm border border-slate-200 p-12 text-center">
                                        <div className="text-slate-400 text-lg">
                                            Select a patient to view details
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {showAddPatient && (
                        <AddPatientModal
                            onClose={() => setShowAddPatient(false)}
                            onAdd={async (name, dob) => {
                                const newPatient = await addPatient(name, dob);
                                setShowAddPatient(false);
                                setSelectedPatient(newPatient);
                            }}
                        />
                    )}
                </div>
            );
        };

        const PatientCard = ({ patient, isSelected, onClick, onDelete, onArchive, showArchived }) => {
            const getStatusColor = (status) => {
                if (status === 'preoperative') return 'bg-blue-100 text-blue-700';
                if (status === 'postoperative') return 'bg-green-100 text-green-700';
                if (status === 'non-surgical') return 'bg-red-100 text-red-700';
                return 'bg-slate-100 text-slate-700';
            };

            return (
                <div
                    className={`p-3 rounded-lg border-2 cursor-pointer transition-all ${
                        isSelected 
                            ? 'border-blue-500 bg-blue-50' 
                            : 'border-slate-200 hover:border-slate-300 bg-white'
                    }`}
                    onClick={onClick}
                >
                    <div className="flex items-start justify-between">
                        <div className="flex-1">
                            <div className="font-semibold text-slate-900">{patient.name}</div>
                            <div className="text-sm text-slate-600">DOB: {patient.dob}</div>
                            {patient.status && (
                                <div className={`inline-block text-xs px-2 py-1 rounded mt-1 ${getStatusColor(patient.status)}`}>
                                    {patient.status}
                                </div>
                            )}
                        </div>
                        <div className="flex gap-1">
                            {!showArchived && (
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        if (confirm('Archive this patient?')) onArchive(patient.id);
                                    }}
                                    className="p-1 text-slate-400 hover:text-amber-600 transition-colors"
                                    title="Archive"
                                >
                                    <Archive size={16} />
                                </button>
                            )}
                            <button
                                onClick={(e) => {
                                    e.stopPropagation();
                                    if (confirm('Delete this patient permanently?')) onDelete(patient.id);
                                }}
                                className="p-1 text-slate-400 hover:text-red-600 transition-colors"
                                title="Delete"
                            >
                                <Trash2 size={16} />
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const AddPatientModal = ({ onClose, onAdd }) => {
            const [name, setName] = useState('');
            const [dob, setDob] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (name && dob) {
                    onAdd(name, dob);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-xl font-bold text-slate-900">Add New Patient</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-slate-600">
                                <X size={24} />
                            </button>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Name</label>
                                <input
                                    type="text"
                                    value={name}
                                    onChange={(e) => setName(e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Date of Birth</label>
                                <input
                                    type="date"
                                    value={dob}
                                    onChange={(e) => setDob(e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required
                                />
                            </div>
                            <div className="flex gap-3 pt-2">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    Add Patient
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const PatientDetails = ({ patient, onUpdate, calculateDays }) => {
            const [expandedSections, setExpandedSections] = useState({});

            const toggleSection = (section) => {
                setExpandedSections(prev => ({ ...prev, [section]: !prev[section] }));
            };

            const updateField = (field, value) => {
                onUpdate(patient.id, { [field]: value });
            };

            const updateNestedField = (parent, field, value) => {
                onUpdate(patient.id, {
                    [parent]: { ...patient[parent], [field]: value }
                });
            };

            const daysOfAdmission = calculateDays(patient.dateOfAdmission);

            return (
                <div className="bg-white rounded-lg shadow-sm border border-slate-200">
                    <div className="p-6 border-b border-slate-200 bg-slate-50">
                        <h2 className="text-2xl font-bold text-slate-900">{patient.name}</h2>
                        <div className="text-slate-600 mt-1">DOB: {patient.dob}</div>
                        {patient.dateOfAdmission && (
                            <div className="text-slate-600 mt-1">Days of Admission: {daysOfAdmission}</div>
                        )}
                    </div>

                    <div className="p-6 space-y-4 max-h-[calc(100vh-300px)] overflow-y-auto">
                        
                        <Section title="Specialty" expanded={expandedSections.specialty} onToggle={() => toggleSection('specialty')}>
                            <div className="space-y-2">
                                <select
                                    value={patient.specialty || ''}
                                    onChange={(e) => updateField('specialty', e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="">Select Specialty</option>
                                    <option value="vascular-surgery">Vascular Surgery</option>
                                    <option value="angiology">Angiology</option>
                                    <option value="thoracic-surgery">Thoracic Surgery</option>
                                </select>
                                <RemarksField
                                    value={patient.remarks?.specialty || ''}
                                    onChange={(val) => updateNestedField('remarks', 'specialty', val)}
                                />
                            </div>
                        </Section>

                        <Section title="Status" expanded={expandedSections.status} onToggle={() => toggleSection('status')}>
                            <div className="space-y-2">
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => updateField('status', 'preoperative')}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.status === 'preoperative'
                                                ? 'bg-blue-500 text-white'
                                                : 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                                        }`}
                                    >
                                        Preoperative
                                    </button>
                                    <button
                                        onClick={() => updateField('status', 'postoperative')}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.status === 'postoperative'
                                                ? 'bg-green-500 text-white'
                                                : 'bg-green-100 text-green-700 hover:bg-green-200'
                                        }`}
                                    >
                                        Postoperative
                                    </button>
                                    <button
                                        onClick={() => updateField('status', 'non-surgical')}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.status === 'non-surgical'
                                                ? 'bg-red-500 text-white'
                                                : 'bg-red-100 text-red-700 hover:bg-red-200'
                                        }`}
                                    >
                                        Non-Surgical
                                    </button>
                                </div>
                                <RemarksField
                                    value={patient.remarks?.status || ''}
                                    onChange={(val) => updateNestedField('remarks', 'status', val)}
                                />
                            </div>
                        </Section>

                        <Section title="Verschoben" expanded={expandedSections.verschoben} onToggle={() => toggleSection('verschoben')}>
                            <div className="space-y-2">
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => updateField('verschoben', true)}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.verschoben === true
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        Yes
                                    </button>
                                    <button
                                        onClick={() => updateField('verschoben', false)}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.verschoben === false
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        No
                                    </button>
                                </div>
                                <RemarksField
                                    value={patient.remarks?.verschoben || ''}
                                    onChange={(val) => updateNestedField('remarks', 'verschoben', val)}
                                />
                            </div>
                        </Section>

                        <Section title="Date of Admission" expanded={expandedSections.dateOfAdmission} onToggle={() => toggleSection('dateOfAdmission')}>
                            <div className="space-y-2">
                                <input
                                    type="date"
                                    value={patient.dateOfAdmission || ''}
                                    onChange={(e) => updateField('dateOfAdmission', e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <RemarksField
                                    value={patient.remarks?.dateOfAdmission || ''}
                                    onChange={(val) => updateNestedField('remarks', 'dateOfAdmission', val)}
                                />
                            </div>
                        </Section>

                        <Section title="Days on ICU & Ventilation" expanded={expandedSections.icu} onToggle={() => toggleSection('icu')}>
                            <ICUAdmissions patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Planned Operation" expanded={expandedSections.plannedOp} onToggle={() => toggleSection('plannedOp')}>
                            <div className="space-y-2">
                                <textarea
                                    value={patient.plannedOperation || ''}
                                    onChange={(e) => updateField('plannedOperation', e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows={3}
                                />
                                <RemarksField
                                    value={patient.remarks?.plannedOperation || ''}
                                    onChange={(val) => updateNestedField('remarks', 'plannedOperation', val)}
                                />
                            </div>
                        </Section>

                        <Section title="Reason for Admission" expanded={expandedSections.reason} onToggle={() => toggleSection('reason')}>
                            <div className="space-y-2">
                                <textarea
                                    value={patient.reasonForAdmission || ''}
                                    onChange={(e) => updateField('reasonForAdmission', e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows={3}
                                />
                                <RemarksField
                                    value={patient.remarks?.reasonForAdmission || ''}
                                    onChange={(val) => updateNestedField('remarks', 'reasonForAdmission', val)}
                                />
                            </div>
                        </Section>

                        <Section title="In Situ" expanded={expandedSections.inSitu} onToggle={() => toggleSection('inSitu')}>
                            <InSitu patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Heimmedikation" expanded={expandedSections.heimmedikation} onToggle={() => toggleSection('heimmedikation')}>
                            <div className="space-y-2">
                                <textarea
                                    value={patient.heimmedikation || ''}
                                    onChange={(e) => updateField('heimmedikation', e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows={4}
                                />
                                <RemarksField
                                    value={patient.remarks?.heimmedikation || ''}
                                    onChange={(val) => updateNestedField('remarks', 'heimmedikation', val)}
                                />
                            </div>
                        </Section>

                        <Section title="DRG" expanded={expandedSections.drg} onToggle={() => toggleSection('drg')}>
                            <div className="space-y-2">
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => updateField('drg', 'DRG')}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.drg === 'DRG'
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        DRG
                                    </button>
                                    <button
                                        onClick={() => updateField('drg', 'UGD')}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.drg === 'UGD'
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        UGD
                                    </button>
                                </div>
                                <RemarksField
                                    value={patient.remarks?.drg || ''}
                                    onChange={(val) => updateNestedField('remarks', 'drg', val)}
                                />
                            </div>
                        </Section>

                        <Section title="OP Vorbereitung" expanded={expandedSections.opVorb} onToggle={() => toggleSection('opVorb')}>
                            <OPVorbereitung patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Geplante Untersuchungen" expanded={expandedSections.untersuchungen} onToggle={() => toggleSection('untersuchungen')}>
                            <GeplanteUntersuchungen patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Zuweiser" expanded={expandedSections.zuweiser} onToggle={() => toggleSection('zuweiser')}>
                            <Zuweiser patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Brief" expanded={expandedSections.brief} onToggle={() => toggleSection('brief')}>
                            <Brief patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Ãœbernahme" expanded={expandedSections.uebernahme} onToggle={() => toggleSection('uebernahme')}>
                            <Uebernahme patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Entlassung" expanded={expandedSections.entlassung} onToggle={() => toggleSection('entlassung')}>
                            <Entlassung patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Wiederaufnahme" expanded={expandedSections.wiederaufnahme} onToggle={() => toggleSection('wiederaufnahme')}>
                            <div className="space-y-2">
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => updateField('wiederaufnahme', true)}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.wiederaufnahme === true
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        Yes
                                    </button>
                                    <button
                                        onClick={() => updateField('wiederaufnahme', false)}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.wiederaufnahme === false
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        No
                                    </button>
                                </div>
                                <RemarksField
                                    value={patient.remarks?.wiederaufnahme || ''}
                                    onChange={(val) => updateNestedField('remarks', 'wiederaufnahme', val)}
                                />
                            </div>
                        </Section>

                        <Section title="Medication" expanded={expandedSections.medication} onToggle={() => toggleSection('medication')}>
                            <Medication patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Complaints" expanded={expandedSections.complaints} onToggle={() => toggleSection('complaints')}>
                            <div className="space-y-2">
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => updateField('complaints', true)}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.complaints === true
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        Yes
                                    </button>
                                    <button
                                        onClick={() => updateField('complaints', false)}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.complaints === false
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        No
                                    </button>
                                </div>
                                <RemarksField
                                    value={patient.remarks?.complaints || ''}
                                    onChange={(val) => updateNestedField('remarks', 'complaints', val)}
                                />
                            </div>
                        </Section>

                        <Section title="Complications" expanded={expandedSections.complications} onToggle={() => toggleSection('complications')}>
                            <Complications patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Nebendiagnose" expanded={expandedSections.nebendiagnose} onToggle={() => toggleSection('nebendiagnose')}>
                            <Nebendiagnose patient={patient} onUpdate={onUpdate} />
                        </Section>

                        <Section title="Privat" expanded={expandedSections.privat} onToggle={() => toggleSection('privat')}>
                            <div className="space-y-2">
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => updateField('privat', true)}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.privat === true
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        Yes
                                    </button>
                                    <button
                                        onClick={() => updateField('privat', false)}
                                        className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                            patient.privat === false
                                                ? 'bg-slate-700 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        No
                                    </button>
                                </div>
                                <RemarksField
                                    value={patient.remarks?.privat || ''}
                                    onChange={(val) => updateNestedField('remarks', 'privat', val)}
                                />
                            </div>
                        </Section>

                    </div>
                </div>
            );
        };

        const Section = ({ title, children, expanded, onToggle }) => (
            <div className="border border-slate-200 rounded-lg">
                <button
                    onClick={onToggle}
                    className="w-full px-4 py-3 flex items-center justify-between bg-slate-50 hover:bg-slate-100 transition-colors rounded-t-lg"
                >
                    <span className="font-semibold text-slate-900">{title}</span>
                    {expanded ? <ChevronDown size={20} /> : <ChevronRight size={20} />}
                </button>
                {expanded && (
                    <div className="p-4 border-t border-slate-200">
                        {children}
                    </div>
                )}
            </div>
        );

        const RemarksField = ({ value, onChange }) => (
            <div>
                <label className="block text-xs font-medium text-slate-600 mb-1">Remarks</label>
                <textarea
                    value={value}
                    onChange={(e) => onChange(e.target.value)}
                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                    rows={2}
                    placeholder="Add remarks..."
                />
            </div>
        );

        const ICUAdmissions = ({ patient, onUpdate }) => {
            const addICUAdmission = () => {
                const newAdmission = {
                    id: Date.now().toString(),
                    startDate: '',
                    stopDate: '',
                    ventilationStart: '',
                    ventilationStop: ''
                };
                onUpdate(patient.id, {
                    icuAdmissions: [...(patient.icuAdmissions || []), newAdmission]
                });
            };

            const updateICUAdmission = (id, field, value) => {
                const updated = patient.icuAdmissions.map(adm =>
                    adm.id === id ? { ...adm, [field]: value } : adm
                );
                onUpdate(patient.id, { icuAdmissions: updated });
            };

            const deleteICUAdmission = (id) => {
                const updated = patient.icuAdmissions.filter(adm => adm.id !== id);
                onUpdate(patient.id, { icuAdmissions: updated });
            };

            const calculateICUDays = (startDate, stopDate) => {
                if (!startDate || !stopDate) return 0;
                const start = new Date(startDate);
                const stop = new Date(stopDate);
                const diffTime = stop - start;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays + 1;
            };

            const calculateVentilationDays = (startDate, stopDate) => {
                if (!startDate || !stopDate) return 0;
                const start = new Date(startDate);
                const stop = new Date(stopDate);
                const diffTime = stop - start;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            };

            return (
                <div className="space-y-4">
                    {(patient.icuAdmissions || []).map(admission => (
                        <div key={admission.id} className="p-3 bg-slate-50 rounded-lg border border-slate-200 space-y-3">
                            <div className="flex justify-between items-start">
                                <div className="text-sm font-medium text-slate-700">ICU Admission</div>
                                <button
                                    onClick={() => deleteICUAdmission(admission.id)}
                                    className="text-red-500 hover:text-red-700"
                                >
                                    <X size={16} />
                                </button>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="block text-xs text-slate-600 mb-1">Start Date</label>
                                    <input
                                        type="date"
                                        value={admission.startDate || ''}
                                        onChange={(e) => updateICUAdmission(admission.id, 'startDate', e.target.value)}
                                        className="w-full px-2 py-1 border border-slate-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs text-slate-600 mb-1">Stop Date</label>
                                    <input
                                        type="date"
                                        value={admission.stopDate || ''}
                                        onChange={(e) => updateICUAdmission(admission.id, 'stopDate', e.target.value)}
                                        className="w-full px-2 py-1 border border-slate-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                            </div>

                            {admission.startDate && admission.stopDate && (
                                <div className="text-sm text-slate-600">
                                    ICU Days: {calculateICUDays(admission.startDate, admission.stopDate)}
                                </div>
                            )}

                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="block text-xs text-slate-600 mb-1">Ventilation Start</label>
                                    <input
                                        type="date"
                                        value={admission.ventilationStart || ''}
                                        onChange={(e) => updateICUAdmission(admission.id, 'ventilationStart', e.target.value)}
                                        className="w-full px-2 py-1 border border-slate-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs text-slate-600 mb-1">Ventilation Stop</label>
                                    <input
                                        type="date"
                                        value={admission.ventilationStop || ''}
                                        onChange={(e) => updateICUAdmission(admission.id, 'ventilationStop', e.target.value)}
                                        className="w-full px-2 py-1 border border-slate-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                            </div>

                            {admission.ventilationStart && admission.ventilationStop && (
                                <div className="text-sm text-slate-600">
                                    Ventilation Days: {calculateVentilationDays(admission.ventilationStart, admission.ventilationStop)}
                                </div>
                            )}
                        </div>
                    ))}

                    <button
                        onClick={addICUAdmission}
                        className="w-full px-4 py-2 border-2 border-dashed border-slate-300 rounded-lg text-slate-600 hover:border-slate-400 hover:text-slate-700 transition-colors"
                    >
                        + Add ICU Admission
                    </button>

                    <RemarksField
                        value={patient.remarks?.icu || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, icu: val } })}
                    />
                </div>
            );
        };

        const InSitu = ({ patient, onUpdate }) => {
            const options = ['PDK', 'PEG', 'Drain', 'ZVK', 'DK', 'Schmerzpumpe', 'PVK'];

            const updateInSitu = (option, date) => {
                onUpdate(patient.id, {
                    inSitu: { ...patient.inSitu, [option]: date }
                });
            };

            return (
                <div className="space-y-2">
                    {options.map(option => (
                        <div key={option} className="flex items-center gap-3">
                            <div className="w-32 text-sm font-medium text-slate-700">{option}</div>
                            <input
                                type="date"
                                value={patient.inSitu?.[option] || ''}
                                onChange={(e) => updateInSitu(option, e.target.value)}
                                className="flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>
                    ))}
                    <RemarksField
                        value={patient.remarks?.inSitu || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, inSitu: val } })}
                    />
                </div>
            );
        };

        const OPVorbereitung = ({ patient, onUpdate }) => {
            const options = ['markierung', 'blutbild und gerinnung', 'EK', 'AK', 'aufklÃ¤rung'];

            const toggleOption = (option) => {
                const current = patient.opVorbereitung || {};
                onUpdate(patient.id, {
                    opVorbereitung: { ...current, [option]: !current[option] }
                });
            };

            return (
                <div className="space-y-2">
                    <div className="grid grid-cols-2 gap-2">
                        {options.map(option => (
                            <button
                                key={option}
                                onClick={() => toggleOption(option)}
                                className={`px-3 py-2 rounded-lg text-sm transition-colors ${
                                    patient.opVorbereitung?.[option]
                                        ? 'bg-green-500 text-white'
                                        : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                }`}
                            >
                                {option}
                            </button>
                        ))}
                    </div>
                    <RemarksField
                        value={patient.remarks?.opVorbereitung || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, opVorbereitung: val } })}
                    />
                </div>
            );
        };

        const GeplanteUntersuchungen = ({ patient, onUpdate }) => {
            const options = ['CT', 'PET', 'bronchoskopie', 'EBUS', 'Ultraschall', 'Doppler', 'Labor', 'RÃ¶ntgen'];

            const updateUntersuchung = (option, date) => {
                onUpdate(patient.id, {
                    geplantUntersuchungen: { ...patient.geplantUntersuchungen, [option]: date }
                });
            };

            return (
                <div className="space-y-2">
                    {options.map(option => (
                        <div key={option} className="flex items-center gap-3">
                            <div className="w-32 text-sm font-medium text-slate-700">{option}</div>
                            <input
                                type="date"
                                value={patient.geplantUntersuchungen?.[option] || ''}
                                onChange={(e) => updateUntersuchung(option, e.target.value)}
                                className="flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>
                    ))}
                    <RemarksField
                        value={patient.remarks?.geplantUntersuchungen || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, geplantUntersuchungen: val } })}
                    />
                </div>
            );
        };

        const Zuweiser = ({ patient, onUpdate }) => {
            const updateZuweiser = (field, value) => {
                onUpdate(patient.id, {
                    zuweiser: { ...patient.zuweiser, [field]: value }
                });
            };

            return (
                <div className="space-y-3">
                    <div>
                        <label className="block text-sm font-medium text-slate-700 mb-1">Zuweiser</label>
                        <input
                            type="text"
                            value={patient.zuweiser?.zuweiser || ''}
                            onChange={(e) => updateZuweiser('zuweiser', e.target.value)}
                            className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-slate-700 mb-1">Hausarzt</label>
                        <input
                            type="text"
                            value={patient.zuweiser?.hausarzt || ''}
                            onChange={(e) => updateZuweiser('hausarzt', e.target.value)}
                            className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>
                    <RemarksField
                        value={patient.remarks?.zuweiser || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, zuweiser: val } })}
                    />
                </div>
            );
        };

        const Brief = ({ patient, onUpdate }) => {
            const suboptions = ['heimmedikation', 'termine', 'tumorkonferenz', 'pantozol', 'antistolling'];

            const setStatus = (status) => {
                onUpdate(patient.id, {
                    brief: { ...patient.brief, status }
                });
            };

            const toggleSuboption = (option) => {
                const current = patient.brief?.items || {};
                onUpdate(patient.id, {
                    brief: { 
                        ...patient.brief, 
                        items: { ...current, [option]: !current[option] }
                    }
                });
            };

            return (
                <div className="space-y-3">
                    <div className="flex gap-2">
                        <button
                            onClick={() => setStatus('gemacht')}
                            className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                patient.brief?.status === 'gemacht'
                                    ? 'bg-green-500 text-white'
                                    : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                            }`}
                        >
                            Gemacht
                        </button>
                        <button
                            onClick={() => setStatus('nicht gemacht')}
                            className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                patient.brief?.status === 'nicht gemacht'
                                    ? 'bg-red-500 text-white'
                                    : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                            }`}
                        >
                            Nicht Gemacht
                        </button>
                    </div>

                    {patient.brief?.status === 'gemacht' && (
                        <div className="grid grid-cols-2 gap-2 pt-2">
                            {suboptions.map(option => (
                                <button
                                    key={option}
                                    onClick={() => toggleSuboption(option)}
                                    className={`px-3 py-2 rounded-lg text-sm transition-colors ${
                                        patient.brief?.items?.[option]
                                            ? 'bg-blue-500 text-white'
                                            : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                    }`}
                                >
                                    {option}
                                </button>
                            ))}
                        </div>
                    )}

                    <RemarksField
                        value={patient.remarks?.brief || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, brief: val } })}
                    />
                </div>
            );
        };

        const Uebernahme = ({ patient, onUpdate }) => {
            const suboptions = ['ITS', 'Normalstation', 'antistolling', 'OP gewenst'];

            const setStatus = (status) => {
                onUpdate(patient.id, {
                    uebernahme: { ...patient.uebernahme, status }
                });
            };

            const toggleSuboption = (option) => {
                const current = patient.uebernahme?.items || {};
                onUpdate(patient.id, {
                    uebernahme: { 
                        ...patient.uebernahme, 
                        items: { ...current, [option]: !current[option] }
                    }
                });
            };

            return (
                <div className="space-y-3">
                    <div className="flex gap-2">
                        <button
                            onClick={() => setStatus(true)}
                            className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                patient.uebernahme?.status === true
                                    ? 'bg-slate-700 text-white'
                                    : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                            }`}
                        >
                            Yes
                        </button>
                        <button
                            onClick={() => setStatus(false)}
                            className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                                patient.uebernahme?.status === false
                                    ? 'bg-slate-700 text-white'
                                    : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                            }`}
                        >
                            No
                        </button>
                    </div>

                    {patient.uebernahme?.status === true && (
                        <div className="grid grid-cols-2 gap-2 pt-2">
                            {suboptions.map(option => (
                                <button
                                    key={option}
                                    onClick={() => toggleSuboption(option)}
                                    className={`px-3 py-2 rounded-lg text-sm transition-colors ${
                                        patient.uebernahme?.items?.[option]
                                            ? 'bg-blue-500 text-white'
                                            : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                    }`}
                                >
                                    {option}
                                </button>
                            ))}
                        </div>
                    )}

                    <RemarksField
                        value={patient.remarks?.uebernahme || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, uebernahme: val } })}
                    />
                </div>
            );
        };

        const Entlassung = ({ patient, onUpdate }) => {
            const addUntersuchung = () => {
                const current = patient.entlassung?.untersuchungen || [];
                if (current.length < 5) {
                    onUpdate(patient.id, {
                        entlassung: {
                            ...patient.entlassung,
                            untersuchungen: [...current, { id: Date.now().toString(), name: '', date: '' }]
                        }
                    });
                }
            };

            const updateUntersuchung = (id, field, value) => {
                const updated = patient.entlassung?.untersuchungen?.map(u =>
                    u.id === id ? { ...u, [field]: value } : u
                ) || [];
                onUpdate(patient.id, {
                    entlassung: { ...patient.entlassung, untersuchungen: updated }
                });
            };

            const deleteUntersuchung = (id) => {
                const updated = patient.entlassung?.untersuchungen?.filter(u => u.id !== id) || [];
                onUpdate(patient.id, {
                    entlassung: { ...patient.entlassung, untersuchungen: updated }
                });
            };

            return (
                <div className="space-y-3">
                    <div>
                        <label className="block text-sm font-medium text-slate-700 mb-1">Entlassungsdatum</label>
                        <input
                            type="date"
                            value={patient.entlassung?.datum || ''}
                            onChange={(e) => onUpdate(patient.id, {
                                entlassung: { ...patient.entlassung, datum: e.target.value }
                            })}
                            className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">Entlassungsuntersuchungen</label>
                        <div className="space-y-2">
                            {(patient.entlassung?.untersuchungen || []).map(u => (
                                <div key={u.id} className="flex gap-2">
                                    <input
                                        type="text"
                                        value={u.name}
                                        onChange={(e) => updateUntersuchung(u.id, 'name', e.target.value)}
                                        placeholder="Untersuchung name"
                                        className="flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <input
                                        type="date"
                                        value={u.date}
                                        onChange={(e) => updateUntersuchung(u.id, 'date', e.target.value)}
                                        className="px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <button
                                        onClick={() => deleteUntersuchung(u.id)}
                                        className="p-2 text-red-500 hover:text-red-700"
                                    >
                                        <X size={20} />
                                    </button>
                                </div>
                            ))}
                            {(patient.entlassung?.untersuchungen || []).length < 5 && (
                                <button
                                    onClick={addUntersuchung}
                                    className="w-full px-4 py-2 border-2 border-dashed border-slate-300 rounded-lg text-slate-600 hover:border-slate-400 hover:text-slate-700 transition-colors"
                                >
                                    + Add Untersuchung
                                </button>
                            )}
                        </div>
                    </div>

                    <RemarksField
                        value={patient.remarks?.entlassung || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, entlassung: val } })}
                    />
                </div>
            );
        };

        const Medication = ({ patient, onUpdate }) => {
            const addMedication = () => {
                const current = patient.medications || [];
                onUpdate(patient.id, {
                    medications: [...current, { id: Date.now().toString(), name: '', startDate: '', stopDate: '' }]
                });
            };

            const updateMedication = (id, field, value) => {
                const updated = patient.medications?.map(m =>
                    m.id === id ? { ...m, [field]: value } : m
                ) || [];
                onUpdate(patient.id, { medications: updated });
            };

            const deleteMedication = (id) => {
                const updated = patient.medications?.filter(m => m.id !== id) || [];
                onUpdate(patient.id, { medications: updated });
            };

            return (
                <div className="space-y-3">
                    {(patient.medications || []).map(med => (
                        <div key={med.id} className="p-3 bg-slate-50 rounded-lg border border-slate-200 space-y-2">
                            <div className="flex justify-between items-start">
                                <input
                                    type="text"
                                    value={med.name}
                                    onChange={(e) => updateMedication(med.id, 'name', e.target.value)}
                                    placeholder="Medication name"
                                    className="flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <button
                                    onClick={() => deleteMedication(med.id)}
                                    className="ml-2 p-2 text-red-500 hover:text-red-700"
                                >
                                    <X size={20} />
                                </button>
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <label className="block text-xs text-slate-600 mb-1">Start Date</label>
                                    <input
                                        type="date"
                                        value={med.startDate}
                                        onChange={(e) => updateMedication(med.id, 'startDate', e.target.value)}
                                        className="w-full px-2 py-1 border border-slate-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs text-slate-600 mb-1">Stop Date</label>
                                    <input
                                        type="date"
                                        value={med.stopDate}
                                        onChange={(e) => updateMedication(med.id, 'stopDate', e.target.value)}
                                        className="w-full px-2 py-1 border border-slate-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                            </div>
                        </div>
                    ))}
                    <button
                        onClick={addMedication}
                        className="w-full px-4 py-2 border-2 border-dashed border-slate-300 rounded-lg text-slate-600 hover:border-slate-400 hover:text-slate-700 transition-colors"
                    >
                        + Add Medication
                    </button>
                    <RemarksField
                        value={patient.remarks?.medications || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, medications: val } })}
                    />
                </div>
            );
        };

        const Complications = ({ patient, onUpdate }) => {
            const options = [
                'pneumonia', 'atelektase', 'prolonged air leak', 'empyema', 'chylothorax',
                'lungenembolie', 'reoperation', 'nachblutung', 'transfusion', 'wundinfektion',
                'wunddehiszenz', 'sepsis', 'respiratory insufficiency', 'VHF', 'herzinsuffizienz',
                'myokardinfarkt', 'schlaganfall', 'nierenversagen', 'delir', 'recurrensparese', 'others'
            ];

            const toggleOption = (option) => {
                const current = patient.complications || {};
                onUpdate(patient.id, {
                    complications: { ...current, [option]: !current[option] }
                });
            };

            return (
                <div className="space-y-2">
                    <div className="grid grid-cols-2 gap-2">
                        {options.map(option => (
                            <button
                                key={option}
                                onClick={() => toggleOption(option)}
                                className={`px-3 py-2 rounded-lg text-sm transition-colors ${
                                    patient.complications?.[option]
                                        ? 'bg-red-500 text-white'
                                        : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                }`}
                            >
                                {option}
                            </button>
                        ))}
                    </div>
                    <RemarksField
                        value={patient.remarks?.complications || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, complications: val } })}
                    />
                </div>
            );
        };

        const Nebendiagnose = ({ patient, onUpdate }) => {
            const options = [
                'COPD', 'asthma bronchiale', 'DM', 'art hypertonie', 'KHK',
                'niereninsuffizienz', 'herzinsuffizienz', 'VHF', 'PAVK', 'adipositas',
                'malnutrition', 'lebererkrankung', 'immunsuppresion', 'aktive malignitÃ¤t',
                'nikotinabusus', 'other'
            ];

            const toggleOption = (option) => {
                const current = patient.nebendiagnose || {};
                onUpdate(patient.id, {
                    nebendiagnose: { ...current, [option]: !current[option] }
                });
            };

            return (
                <div className="space-y-2">
                    <div className="grid grid-cols-2 gap-2">
                        {options.map(option => (
                            <button
                                key={option}
                                onClick={() => toggleOption(option)}
                                className={`px-3 py-2 rounded-lg text-sm transition-colors ${
                                    patient.nebendiagnose?.[option]
                                        ? 'bg-amber-500 text-white'
                                        : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                }`}
                            >
                                {option}
                            </button>
                        ))}
                    </div>
                    <RemarksField
                        value={patient.remarks?.nebendiagnose || ''}
                        onChange={(val) => onUpdate(patient.id, { remarks: { ...patient.remarks, nebendiagnose: val } })}
                    />
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<StationaryPatients />, document.getElementById('root'));
    </script>
</body>
</html>
